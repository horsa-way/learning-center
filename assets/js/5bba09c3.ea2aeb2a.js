"use strict";(self.webpackChunklearning_center=self.webpackChunklearning_center||[]).push([[9111],{5583:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>l,toc:()=>d});var r=n(85893),t=n(11151);const s={},a="BC API",l={id:"business-central/api/bc-api",title:"BC API",description:"In Business Central le API sono di tipologia REST basate su protoccolo OData e sono molto semplici da realizzare.",source:"@site/docs/business-central/11-api/02-bc-api.md",sourceDirName:"business-central/11-api",slug:"/business-central/api/bc-api",permalink:"/learning-center/docs/business-central/api/bc-api",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{},sidebar:"businessCentralSidebar",previous:{title:"Nozioni di base",permalink:"/learning-center/docs/business-central/api/theory"},next:{title:"API Esterne",permalink:"/learning-center/docs/business-central/api/external-api"}},o={},d=[{value:"Prerequisiti",id:"prerequisiti",level:2},{value:"Abilitare Business Central",id:"abilitare-business-central",level:3},{value:"Primo Test",id:"primo-test",level:2},{value:"Creare API Custom",id:"creare-api-custom",level:2},{value:"Costruzione degli URL",id:"costruzione-degli-url",level:3},{value:"Basic Operations",id:"basic-operations",level:2},{value:"GET API",id:"get-api",level:2},{value:"Filtrare",id:"filtrare",level:3},{value:"POST API",id:"post-api",level:2},{value:"PATCH API",id:"patch-api",level:2},{value:"DELETE API",id:"delete-api",level:2},{value:"Esercizio",id:"esercizio",level:2},{value:"Connessione con Power Platform",id:"connessione-con-power-platform",level:2}];function c(e){const i={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.h1,{id:"bc-api",children:"BC API"}),"\n",(0,r.jsx)(i.p,{children:"In Business Central le API sono di tipologia REST basate su protoccolo OData e sono molto semplici da realizzare."}),"\n",(0,r.jsx)(i.h2,{id:"prerequisiti",children:"Prerequisiti"}),"\n",(0,r.jsxs)(i.p,{children:["Installare ",(0,r.jsx)(i.a,{href:"https://www.postman.com/downloads/?utm_source=postman-home",children:"Postman"}),": \xe8 un popolare strumento di sviluppo API utilizzato da sviluppatori per testare, sviluppare e documentare API. Offre una piattaforma user-friendly per inviare richieste HTTP, testare le risposte e visualizzare i risultati. Postman supporta vari tipi di richieste come GET, POST, PUT e DELETE, rendendolo ideale per lavorare con API RESTful."]}),"\n",(0,r.jsx)(i.h3,{id:"abilitare-business-central",children:"Abilitare Business Central"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsx)(i.li,{children:"Open the Business Central Administration Shell with administrator privilege."}),"\n",(0,r.jsx)(i.li,{children:"Esegui questi tre comandi: abilita gli Odata, abilita le API e attiva l'autenticazione NTLM."}),"\n"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-powershell",children:"Set-NAVServerConfiguration -ServerInstance <BC_instance> -KeyName ODataServicesEnabled -KeyValue true\nSet-NAVServerConfiguration -ServerInstance <BC_instance> -KeyName ApiServicesEnabled -KeyValue true\nSet-NAVServerConfiguration -ServerInstance <BC_instance> -KeyName ServicesUseNTLMAuthentication -KeyValue true\n"})}),"\n",(0,r.jsxs)(i.ol,{start:"3",children:["\n",(0,r.jsx)(i.li,{children:"Verifica il numero della tua porta ODataServicesPort tramite:"}),"\n"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-powershell",children:"Get-NAVServerConfiguration -ServerInstance <BC_instance>\n"})}),"\n",(0,r.jsx)(i.h2,{id:"primo-test",children:"Primo Test"}),"\n",(0,r.jsx)(i.p,{children:"Testiamo l'API companies che \xe8 gi\xe0 pronta all'interno dell'ambiente Business Central, rid\xe0 come risposta la lista delle company attive su Business Central."}),"\n",(0,r.jsx)(i.p,{children:"Bisogna lanciare una richiesta HTTP GET all'indirizzo:"}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.code,{children:"http://<host>:<port>/<serverinstance>/api/v2.0/companies"})}),"\n",(0,r.jsx)(i.p,{children:"Se la tua installazione \xe8 standard, molto probabilmente i dati mancanti sono:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"<host>"})," = localhost"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"<port>"})," = 7048"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"<serverinstance>"})," = BC210"]}),"\n"]}),"\n",(0,r.jsxs)(i.p,{children:["e quindi la costruzione del ",(0,r.jsx)(i.code,{children:"<base URL>"})," a cui far\xf2 riferimento da qui in avanti diventa: ",(0,r.jsx)(i.code,{children:"http://localhost:7048/BC210"})]}),"\n",(0,r.jsx)(i.p,{children:"Possiamo farlo in due modi:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Incollare l'indirizzo dentro un web browser (chrome, edge...)"}),"\n",(0,r.jsx)(i.li,{children:"Testare il metodo su Postman"}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"creare-api-custom",children:"Creare API Custom"}),"\n",(0,r.jsx)(i.p,{children:"Per creare una nuova API in Business Central, devi creare una Page e quindi impostare la propriet\xe0 PageType = API. Devi impostare anche le seguenti propriet\xe0:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"APIPublisher"})," - Il nome dell'azienda che ha creato le API. Questo valore viene utilizzato nell'URL per connettersi all'API e viene utilizzato per raggruppare tutte le API dello stesso publisher."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"APIGroup"})," - Un gruppo utilizzato per raggruppare logicamente un insieme di API. Questo valore viene utilizzato anche nell'URL per connettersi all'API."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"APIVersion"})," - La versione della tua API. Puoi creare pi\xf9 versioni della stessa API. Ogni versione \xe8 un oggetto separato, con il proprio numero di oggetto. Tuttavia, puoi supportare pi\xf9 versioni contemporaneamente. In questo modo, gli altri servizi che si basano sul tuo servizio API non devono essere modificati direttamente quando il tuo servizio aggiunge un nuovo campo o modifica la struttura dell'API. Il valore di questo campo pi\xf2 essere: beta or v1.0, v1.1, v1.2, v2.0, and so on."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"EntityName"})," - Il valore singolo dell'entit\xe0 restituita dall'API (Customer, Item, Car, Vendor, Artist, Movie, and so on)."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"EntitySetName"})," - Questo parametro \xe8 il valore plurale per l'entit\xe0 restituita dall'API (Customers, Items, Cars, Vendors, Artists, Movies, and so on)."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"ODataKeyFields"})," - Questa propriet\xe0 indica quale campo verr\xe0 utilizzato come chiave. Quando richiedi un record specifico, puoi impostare questa propriet\xe0 per indicare quale campo utilizzerai per cercare quel particolare record. Microsoft crea un campo SystemId, che \xe8 disponibile su ogni tabella, anche sulle tue tabelle, senza la necessit\xe0 di doverlo creare tu stesso. Il campo SystemId identificher\xe0 un record in modo univoco e non cambier\xe0 mai nel tempo, anche se aggiorni la chiave primaria. Ti consiglo di utilizzare il campo SystemId come ODataKeyFields."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"DelayedInsert"})," - Questo valore deve essere sempre impostato su true per le pagine API. Questa impostazione garantisce che i valori vengano inseriti nel database solo quando viene effettuato il provisioning di tutti i valori dalla richiesta API."]}),"\n"]}),"\n",(0,r.jsx)(i.p,{children:"L'esempio di codice seguente mostra la struttura di una pagina API personalizzata che utilizza la tabella Customer."}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-al",children:"page 50115 \"My Custom Customer API\"\n{\n    PageType = API;\n    APIVersion = 'v1.0';\n    APIPublisher = 'mycompany';\n    APIGroup = 'sales';\n    EntityName = 'mycustomer';\n    EntitySetName = 'mycustomers';\n    DelayedInsert = true;\n    SourceTable = Customer;\n    ODataKeyFields = SystemId;\n\n    layout\n    {\n        area(Content)\n        {\n            repeater(GroupName)\n            {\n                field(id;SystemId)\n                {\n                    ApplicationArea = All;\n                }\n                field(name;Name)\n                {\n                    ApplicationArea = All;\n                }\n                field(email;\"E-Mail\")\n                {\n                    ApplicationArea = All;\n                }\n            }\n        }\n    }\n}\n"})}),"\n",(0,r.jsx)(i.h3,{id:"costruzione-degli-url",children:"Costruzione degli URL"}),"\n",(0,r.jsx)(i.p,{children:"In business central OnPremise gli URL delle API sono costruiti nel seguente modo:"}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.code,{children:"<base URL>/api/<API publisher>/<API group>/<API version>/<entitysetname>"})}),"\n",(0,r.jsx)(i.p,{children:"Nel caso specifico l'url quindi diventa:"}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.code,{children:"<base URL>/api/mycompany/sales/v1.0/mycustomers"})}),"\n",(0,r.jsx)(i.p,{children:"Provare quindi a contattarlo per visuallizzare la risposta."}),"\n",(0,r.jsx)(i.p,{children:"Nel caso in cui la richiesta restituisca un errore relativa alla company, bisogna inserire anche l'id della company a cui si vuole accedere, quindi l'url diventa:"}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.code,{children:"<base URL>/api/mycompany/sales/v1.0/companies(<company id>)/mycustomers"})}),"\n",(0,r.jsx)(i.h2,{id:"basic-operations",children:"Basic Operations"}),"\n",(0,r.jsxs)(i.table,{children:[(0,r.jsx)(i.thead,{children:(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.th,{children:"Method"}),(0,r.jsx)(i.th,{children:"Description"}),(0,r.jsx)(i.th,{children:"Example"})]})}),(0,r.jsxs)(i.tbody,{children:[(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"GET"}),(0,r.jsx)(i.td,{children:"List collection"}),(0,r.jsxs)(i.td,{children:["GET ",(0,r.jsx)(i.code,{children:".../entitysetname"})]})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"GET"}),(0,r.jsx)(i.td,{children:"Get member of the collection"}),(0,r.jsxs)(i.td,{children:["GET ",(0,r.jsx)(i.code,{children:".../entitysetname({id})"})]})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"POST"}),(0,r.jsx)(i.td,{children:"Create new entity in the collection"}),(0,r.jsxs)(i.td,{children:["POST ",(0,r.jsx)(i.code,{children:".../entitysetname/"})]})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"PATCH"}),(0,r.jsx)(i.td,{children:"Update entity"}),(0,r.jsxs)(i.td,{children:["PATCH ",(0,r.jsx)(i.code,{children:".../entitysetname({id})"})]})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"DELETE"}),(0,r.jsx)(i.td,{children:"Delete entity"}),(0,r.jsxs)(i.td,{children:["DELETE ",(0,r.jsx)(i.code,{children:".../entitysetname({id})"})]})]})]})]}),"\n",(0,r.jsx)(i.h2,{id:"get-api",children:"GET API"}),"\n",(0,r.jsx)(i.p,{children:"Per leggere i dati da una tabella, \xe8 necessario utilizzare il metodo GET. Il metodo GET pu\xf2 essere utilizzato per leggere un singolo record o un elenco di record:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["Elenco di record: ",(0,r.jsx)(i.code,{children:".../<entitysetname>"})]}),"\n",(0,r.jsxs)(i.li,{children:["Singolo record: ",(0,r.jsx)(i.code,{children:".../<entitysetname>(<id>)"})]}),"\n"]}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.img,{alt:"API2",src:n(53207).Z+"",width:"1314",height:"608"})}),"\n",(0,r.jsx)(i.h3,{id:"filtrare",children:"Filtrare"}),"\n",(0,r.jsxs)(i.p,{children:["Per filtrare i dati, \xe8 necessario utilizzare il parametro $filter. Il parametro $filter deve essere integrato nell'URL nel seguente modo: ",(0,r.jsx)(i.code,{children:".../<entitysetname>?$filter=<filter>"})]}),"\n",(0,r.jsx)(i.p,{children:"Il parametro $filter pu\xf2 essere utilizzato con i seguenti operatori:"}),"\n",(0,r.jsxs)(i.table,{children:[(0,r.jsx)(i.thead,{children:(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.th,{children:"Operator"}),(0,r.jsx)(i.th,{children:"Description"}),(0,r.jsx)(i.th,{children:"Example"})]})}),(0,r.jsxs)(i.tbody,{children:[(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"eq"}),(0,r.jsx)(i.td,{children:"Equal"}),(0,r.jsx)(i.td,{children:"$filter=category eq 'Expense'"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"ne"}),(0,r.jsx)(i.td,{children:"Not equal"}),(0,r.jsx)(i.td,{children:"$filter=unitPrice ne 0"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"gt"}),(0,r.jsx)(i.td,{children:"Greater than"}),(0,r.jsx)(i.td,{children:"$filter=unitPrice gt 1000"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"ge"}),(0,r.jsx)(i.td,{children:"Greater than or equal"}),(0,r.jsx)(i.td,{children:"$filter=unitPrice ge 1000"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"lt"}),(0,r.jsx)(i.td,{children:"Less than"}),(0,r.jsx)(i.td,{children:"$filter=unitPrice lt 1000"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"le"}),(0,r.jsx)(i.td,{children:"Less than or equal"}),(0,r.jsx)(i.td,{children:"$filter=unitPrice le 1000"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"and"}),(0,r.jsx)(i.td,{children:"Logical and"}),(0,r.jsx)(i.td,{children:"$filter=number ge '50000' and number lt '60000'"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"or"}),(0,r.jsx)(i.td,{children:"Logical or"}),(0,r.jsx)(i.td,{children:"$filter=category eq 'Expense' or category eq 'Income'"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"not"}),(0,r.jsx)(i.td,{children:"Logical negation"}),(0,r.jsx)(i.td,{children:"Not supported"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"()"}),(0,r.jsx)(i.td,{children:"Precedence grouping"}),(0,r.jsx)(i.td,{children:"$filter=(category eq 'Expense' or category eq 'Income') and (number ge '40000' and number lt '50000')"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"contains"}),(0,r.jsx)(i.td,{children:"Search for substring"}),(0,r.jsx)(i.td,{children:"$filter=contains(displayName, 'red')"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"endswith"}),(0,r.jsx)(i.td,{children:"Test if first string ends with second string"}),(0,r.jsx)(i.td,{children:"$filter=endswith(email,'contoso.com')"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"startswith"}),(0,r.jsx)(i.td,{children:"Test if first string starts with second string"}),(0,r.jsx)(i.td,{children:"$filter=startswith(email,'aj')"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"concat"}),(0,r.jsx)(i.td,{children:"Returns a string that appends the second parameter to the first"}),(0,r.jsx)(i.td,{children:"Not supported"})]})]})]}),"\n",(0,r.jsx)(i.h2,{id:"post-api",children:"POST API"}),"\n",(0,r.jsxs)(i.p,{children:["Per inserire un record in una tabella, \xe8 necessario utilizzare il metodo POST all'url ",(0,r.jsx)(i.code,{children:".../<entitysetname>"}),". Il body della richiesta deve contenere i dati del record da inserire sotto forma di JSON. Restituir\xe0 un codice di stato 201 Created e il record inserito."]}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.img,{alt:"API3",src:n(75342).Z+"",width:"1311",height:"647"})}),"\n",(0,r.jsx)(i.h2,{id:"patch-api",children:"PATCH API"}),"\n",(0,r.jsxs)(i.p,{children:["Per modificare un record in una tabella, \xe8 necessario utilizzare il metodo PATCH all'url ",(0,r.jsx)(i.code,{children:".../<entitysetname>(<id>)"}),". Il body della richiesta deve contenere i dati del record da modificare sotto forma di JSON. Restituir\xe0 un codice di stato 200 OK e il record modificato. In aggiunta bisogna anche inserire l'header ",(0,r.jsx)(i.code,{children:"If-Match"})," con il valore ",(0,r.jsx)(i.code,{children:"*"}),"."]}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.img,{alt:"API4",src:n(19367).Z+"",width:"1316",height:"542"})}),"\n",(0,r.jsx)(i.h2,{id:"delete-api",children:"DELETE API"}),"\n",(0,r.jsxs)(i.p,{children:["Per eliminare un record in una tabella, \xe8 necessario utilizzare il metodo DELETE all'url ",(0,r.jsx)(i.code,{children:".../<entitysetname>(<id>)"}),". Restituir\xe0 un codice di stato 204 No Content."]}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.img,{alt:"API4",src:n(23095).Z+"",width:"1317",height:"437"})}),"\n",(0,r.jsx)(i.h2,{id:"esercizio",children:"Esercizio"}),"\n",(0,r.jsx)(i.p,{children:'Costruire un\'API per la Squash application creata nelle precedenze lezioni. Creare una pagina "SquashPlayerAPI" con i seguenti campi: id, no, name, member. Provare a leggere, inserire, modificare ed eliminare i dati tramite postman.'}),"\n",(0,r.jsx)(i.h2,{id:"connessione-con-power-platform",children:"Connessione con Power Platform"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:["Scaricare ",(0,r.jsx)(i.a,{href:"https://learn.microsoft.com/en-us/data-integration/gateway/service-gateway-install#download-and-install-a-standard-gateway",children:"On-premises Data Gateway"})," e installare seguendo i passaggi.\nUn gateway dati on-premises \xe8 un software che viene installato in una rete locale (on-premises) e ne agevola l'accesso ai dati presenti. Una delle sue applicazioni pi\xf9 significative \xe8 nell'ambito dell'integrazione tra sistemi locali e soluzioni basate su cloud. Nello specifico, questo gateway di Microsoft \xe8 utilizzato per collegare Business Central, installato su macchine locali, con Power Apps nel cloud. In questo modo, funge da ponte, permettendo alle applicazioni basate su cloud di interagire in modo sicuro e efficiente con i dati e le risorse aziendali gestiti localmente."]}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:["Seguire ",(0,r.jsx)(i.a,{href:"https://powerautomate.microsoft.com/it-it/blog/on-premise-apis/",children:"questa"})," guida dal punto 2: consente di creare un custom connector al nostro gateway. In seguito potrete utilizzare questo connettore nelle power apps. --\x3e"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,t.a)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},53207:(e,i,n)=>{n.d(i,{Z:()=>r});const r=n.p+"assets/images/API2-25cebde6c0f87c71cb7cfb9dfe1083a6.png"},75342:(e,i,n)=>{n.d(i,{Z:()=>r});const r=n.p+"assets/images/API3-2aaa34511421570c13870b5c44e35f74.png"},19367:(e,i,n)=>{n.d(i,{Z:()=>r});const r=n.p+"assets/images/API4-14865e6cfbc4020d0c789a8dded7d0e4.png"},23095:(e,i,n)=>{n.d(i,{Z:()=>r});const r=n.p+"assets/images/API5-d96d08846e8f82fed7b7df376be8e976.png"},11151:(e,i,n)=>{n.d(i,{Z:()=>l,a:()=>a});var r=n(67294);const t={},s=r.createContext(t);function a(e){const i=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function l(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),r.createElement(s.Provider,{value:i},e.children)}}}]);